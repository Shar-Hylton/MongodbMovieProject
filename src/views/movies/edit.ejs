<%- include('../partials/header') %>
<div class="max-w-2xl mx-auto mt-10 p-6 bg-white dark:bg-gray-800 shadow-lg rounded-xl transition-all duration-500 hover:shadow-2xl">
  <h2 class="text-3xl font-bold mb-8 text-center text-gray-900 dark:text-gray-100">Edit Movie</h2>

  <% if (errors && errors.length) { %>
    <div class="alert-error mb-6 p-4 rounded bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-200">
      <ul class="list-disc pl-5">
        <% errors.forEach(err => { %>
          <li><i class="fa-solid fa-triangle-exclamation mr-1"></i><%= err.msg %></li>
        <% }) %>
      </ul>
    </div>
  <% } %>

  <form action="/movies/edit/<%= movie._id %>" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Movie Name -->
    <div class="col-span-1 md:col-span-1">
      <label for="name" class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">Movie Name</label>
      <input
        type="text"
        id="name"
        name="name"
        value="<%= old?.name || movie.name %>"
        placeholder="Movie Title"
        class="shadow border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-100 dark:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300"
        required
      >
    </div>

    <!-- Year -->
    <div>
      <label for="year" class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">Year</label>
      <input
        type="number"
        id="year"
        name="year"
        value="<%= old?.year || movie.year %>"
        placeholder="1990"
        min="1900"
        max="<%= new Date().getFullYear() %>"
        class="shadow border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-100 dark:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300"
      >
    </div>

    <!-- Rating -->
  <div>
    <label for="rating" class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">Rating</label>
    <input
      type="number"
      id="rating"
      name="rating"
      value="<%= old?.rating || movie.rating %>"
      placeholder="0-5"
      min="0"
      max="5"
      step="0.1"
      class="shadow border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-100 dark:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300"
    >
  </div>

    <!-- Poster URL -->
    <div>
      <label for="posterUrl" class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">Poster URL</label>
      <input
        type="url"
        id="posterUrl"
        name="posterUrl"
        value="<%= old?.posterUrl || movie.posterUrl || '' %>"
        placeholder="https://example.com/poster.jpg"
        class="shadow border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-100 dark:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300"
      >
      <div class="mt-3">
        <% const previewUrl = old?.posterUrl || movie.posterUrl; %>
        <% if (previewUrl) { %>
          <img id="posterPreview" src="<%= previewUrl %>" alt="Poster Preview" class="w-full h-48 object-cover rounded" />
        <% } else { %>
          <div id="posterPreview" class="w-full h-48 bg-gray-200 flex items-center justify-center text-gray-400 rounded">
            <i class="fa-solid fa-film fa-2x"></i>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Description (full width) -->
    <div class="col-span-1 md:col-span-2">
      <label for="description" class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">Description</label>
      <textarea
        id="description"
        name="description"
        placeholder="Movie description"
        rows="4"
        class="shadow border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-100 dark:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300"
        required
      ><%= old?.description || movie.description %></textarea>
    </div>

    <!-- Genres -->
  <div class="col-span-1 md:col-span-2">
    <label class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">Genres</label>
    <div class="flex flex-wrap gap-2">
      <% const allGenres = ['Action', 'Comedy', 'Drama', 'Horror', 'Romance', 'Sci-Fi', 'Thriller', 'Adventure', 'Fantasy', 'Mystery']; %>
      <% const selectedGenres = Array.isArray(old?.genres) ? old.genres : (old?.genres ? [old.genres] : (movie.genres || [])); %>
      <% allGenres.forEach(genre => { %>
            <div class="flex items-center space-x-2">
              <input
                type="checkbox"
                name="genres"
                value="<%= genre %>"
                <%= selectedGenres.includes(genre) ? 'checked' : '' %>
                class="form-checkbox h-4 w-4 text-blue-600"
              >
              <span class="text-sm text-gray-700 dark:text-gray-200"><%= genre %></span>
            </div>
      <% }) %>
    </div>
  </div>

    <!-- Submit button (full width) -->
    <div class="col-span-1 md:col-span-2">
      <button type="submit" class="btn-primary w-full font-bold py-2 rounded shadow-md hover:shadow-xl hover:scale-105 transform transition-all duration-300 ease-in-out text-white bg-blue-600 hover:bg-blue-700">
        <i class="fa-solid fa-pen-to-square mr-2"></i> Update Movie
      </button>
    </div>

  </form>

  <p class="text-center mt-6 text-gray-600 dark:text-gray-300">
    <a href="/movies/<%= movie._id %>" class="text-blue-600 dark:text-blue-400 hover:underline hover:text-blue-800 transition duration-300 font-semibold">
      <i class="fa-solid fa-arrow-left mr-1"></i>Back to Movie Details
    </a>
  </p>
</div>

<script>
  // Pill button toggle
  // Poster preview update
  const posterInput = document.getElementById('posterUrl');
  const posterPreview = document.getElementById('posterPreview');
  if (posterInput) {
    posterInput.addEventListener('input', () => {
      const url = posterInput.value.trim();
      if (!url) {
        if (posterPreview.tagName === 'IMG') {
          posterPreview.replaceWith(document.createElement('div'));
        }
        return;
      }
      const img = document.createElement('img');
      img.src = url;
      img.alt = 'Poster Preview';
      img.className = 'w-full h-48 object-cover rounded';
      posterPreview.replaceWith(img);
    });
  }
</script>

<%- include('../partials/footer') %>
